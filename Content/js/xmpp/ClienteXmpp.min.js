"use strict";function ClienteXmpp(n,t,i){if(this.usuario=n,this.host=t,this.servidor=i,n===undefined||n==="")throw"Usuário xmpp invalido!";if(t===undefined||t==="")throw"Host invalido!";if(i===undefined||i==="")throw"Servidor invalido!";this.urlHttpBind="http://"+i+"/http-bind/";this.jid=n+"@"+t;this.senha="@servidor123";this.registrarUsuarioXmpp=this.registrarUsuarioXmpp.bind(this);this.conectarXmpp=this.conectarXmpp.bind(this);this.iniciarClienteXmpp=this.iniciarClienteXmpp.bind(this);this.aoRegistrar=this.aoRegistrar.bind(this);this.aoConectar=this.aoConectar.bind(this);this.aoReceberMensagem=this.aoReceberMensagem.bind(this)}ClienteXmpp.prototype={iniciarClienteXmpp:function(){try{this.conexao=new Strophe.Connection(this.urlHttpBind);this.registrarUsuarioXmpp();PubSub.subscribe("CONECTAR_XMPP",this.conectarXmpp)}catch(n){console.log("Erro ao executar cliente Xmpp: ",n)}},aoRegistrar:function(n){switch(n){case Strophe.Status.REGISTER:this.conexao.register.fields.username=this.usuario;this.conexao.register.fields.password=this.senha;this.conexao.register.submit();break;case Strophe.Status.REGISTERED:console.log("usuário registrado");PubSub.publish("CONECTAR_XMPP");break;case Strophe.Status.CONFLICT:console.log("usuário ja registrado");PubSub.publish("CONECTAR_XMPP");break;case Strophe.status.REGIFAIL:console.log("servidor não suporta In-Band Registration");break;default:console.log("default ",n)}},registrarUsuarioXmpp:function(){this.conexao.disconnect();this.conexao=new Strophe.Connection(this.urlHttpBind);this.conexao.register.connect(this.servidor,this.aoRegistrar,60,1)},aoConectar:function(n){switch(n){case Strophe.Status.CONNECTING:console.log("Connectando ao servidor xmpp ...");break;case Strophe.Status.CONNFAIL:console.log("falhou ao se connectar ao servidor xmpp.");break;case Strophe.Status.AUTHFAIL:console.log("Não conseguiu autenticar no servidor xmpp.");break;case Strophe.Status.CONNECTED:console.log("conectado ao servidor xmpp.");this.conexao.addHandler(this.aoReceberMensagem,null,"message",null,null,null);this.conexao.send($pres());break;default:console.log("erro desconhecido")}},conectarXmpp:function(){this.conexao.disconnect();this.conexao=new Strophe.Connection(this.urlHttpBind);this.conexao.connect(this.jid,this.senha,this.aoConectar)},aoReceberMensagem:function(n){var i=n.getElementsByTagName("body")[0].innerHTML,t=JSON.parse(i);return t.tipo===undefined&&(t=JSON.parse(t)),PubSub.publish(t.tipo,t),!0}};